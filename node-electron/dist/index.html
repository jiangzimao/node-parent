<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="application/javascript">
        console.log('start test.');
        window.app = {};
        const socketClient = new WebSocket('ws://localhost:8081/node/webSocket');
        socketClient.onopen = function () {
            const req = { messageType: 'REGISTER', data: 'register'};
            socketClient.send(JSON.stringify(req));
            console.info('send register info.')
        };
        socketClient.onmessage = function (msg, fun) {
            const data = msg.data;
            if(data !== null && data !== undefined) {
                const message = JSON.parse(data);
                const { messageType, clientId, status } = message;
                if(messageType !== null && messageType !== undefined && messageType === 'REGISTER') {
                    if(status) {
                        window.socketClientId = clientId;
                        console.info(`Client registration is successful, clientId is ${window.socketClientId}.`)
                    } else {
                        console.error('Client registration failure.')
                    }
                    document.getElementById('main').src = 'http://localhost:8080/client.html';
                    return;
                }
            }
            console.info(msg.data);
            if(fun !== null && fun !== undefined) {
                fun(msg.data);
            }
        };
        socketClient.onclose = function (fun) {
            if(fun !== null && fun !== undefined) {
                fun();
            }
        };
        socketClient.onerror = function(err){
            console.error(err);
        };
        document.getElementById('main').src = 'http://localhost:8080/client.html';
    </script>
</head>
<body style="padding: 0; width: auto; height: auto;">
<iframe id="main" style="border: 0"></iframe>
</body>
</html>